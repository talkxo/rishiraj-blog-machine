<!DOCTYPE html>
<html lang="en">
  {% include head.html %}

  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <main id="main-content" class="u-container">
      {{ content }}
    </main>
    <!-- Deferred scripts -->
    <script defer>
      // Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
              console.log('SW registered: ', registration);
            })
            .catch(function(registrationError) {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
    </script>
    <script defer>
      // Font Loading Observer for LCP optimization
      window.addEventListener('load', function() {
        if ('fonts' in document) {
          Promise.all([
            document.fonts.load('400 1em "Source Sans 3"'),
            document.fonts.load('700 1em "Source Sans 3"'),
            document.fonts.load('400 1em "Roboto Mono"')
          ]).then(function() {
            document.documentElement.classList.add('fonts-loaded');
            console.log('Critical fonts loaded');
          }).catch(function() {
            console.log('Font loading failed, using fallbacks');
          });
        }
      });
    </script>
    <script defer>
      // Core Web Vitals Monitoring
      window.addEventListener('load', function() {
        if ('PerformanceObserver' in window) {
          // LCP
          new PerformanceObserver((list) => {
            const entries = list.getEntries();
            const lastEntry = entries[entries.length - 1];
            console.log('LCP:', lastEntry.startTime);
          }).observe({entryTypes: ['largest-contentful-paint']});
          
          // FID
          new PerformanceObserver((list) => {
            const entries = list.getEntries();
            entries.forEach((entry) => {
              console.log('FID:', entry.processingStart - entry.startTime);
            });
          }).observe({entryTypes: ['first-input']});
          
          // CLS
          new PerformanceObserver((list) => {
            let cls = 0;
            const entries = list.getEntries();
            entries.forEach((entry) => {
              if (!entry.hadRecentInput) {
                cls += entry.value;
              }
            });
            console.log('CLS:', cls);
          }).observe({entryTypes: ['layout-shift']});
        }
      });
    </script>
  </body>
</html>
