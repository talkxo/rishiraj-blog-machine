<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/images/favicons/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/images/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Meta information -->
  <title>Creating slugs for Ecto schemas</title>
  <meta name="description"
        content="What is a slug?">
  <link rel="canonical"
        href="http://localhost:4000/2017/07/creating-slugs-for-ecto-schemas" />

  <!-- Open search scheme -->
  <link rel="search"
        type="application/opensearchdescription+xml"
        title="sobolevn.me"
        href="/opensearch.xml" />

  <!-- Feed -->
  <link rel="alternate" type="application/rss+xml" title="rishi raj's blog"
        href="/feed.xml" />

  <!-- Custom fonts -->
  <link href="https://fonts.googleapis.com/css?family=Merriweather:400,400i,900|Roboto+Mono:400,400i|Montserrat:400,800" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

  <!-- Custom style -->
  <link rel="stylesheet" href="/css/main.css" />

  <!-- Global site tag (gtag.js) - Google Ads: 839642990 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-839642990"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-839642990');
  </script>
</head>


  <body>
    <main class="u-container">
      <div class="c-page">
  <header class="c-page__header">
  <h1><code>rishi raj's blog</code></h1>

  

  <nav role="navigation">
    <a href="/" role="menuitem">
      Blog
    </a>

    <span class="u-separate"></span>
    <a href="/talks/" role="menuitem">
      Talks
    </a>

    <span class="u-separate"></span>
    <a href="/activities/" role="menuitem">
      Activities
    </a>

    <span class="u-separate"></span>
    <a href="/about/" role="menuitem">
      About
    </a>

    <span class="u-separate"></span>
    <a href="/subscribe/" role="menuitem">
      Subscribe
    </a>
  </nav>
</header>

  <div class="c-page__main">
    <article class="c-article" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header class="c-article__header">
    <h1 class="c-article__title" itemprop="name">Creating slugs for Ecto schemas</h1>
    <p class="c-article__time">
      <small>
        <time datetime="2017-07-19T00:00:00+05:30" itemprop="datePublished">
          July 19, 2017
        </time>
      </small>
      <small><span class="reading-time" title="Estimated read time">
  
  
    6 mins
   read
</span>
</small>
      <small><a href="#discussion">Start a discussion</a></small>
      <small><a href="https://github.com/sobolevn/sobolevn.github.io/blob/master/_posts/2017-07-19-creating-slugs-for-ecto-schemas.md">Edit this page</a></small>
    </p>
  </header>

  <!-- Post Tags -->
  <!-- <ul class="c-tags">
    
    <li class="c-tag">elixir</li>
    
  </ul> -->

  <!-- Content -->
  <div class="c-article__main">

    

    <div class="c-article__body" itemprop="articleBody">
      <h2 id="what-is-a-slug">
        
        <a class="anchor" href="#what-is-a-slug">What is a slug?</a>
        
      </h2>

<p>The term “slug” comes from the world of newspaper production. If you have ever created a simple “Blog” application you have already reinvented it.</p>

<p>When you need to access any post at some URL you need to identify it somehow. The simplest idea is to identify them by id, but that does not seem too pretty.
It would be better to identify your posts based on its title or content.
So, a blog post with a title “Creating slugs for Ecto models” would be accessible via a nice-looking URL: <code class="language-plaintext highlighter-rouge">myapp.com/posts/creating-slugs-for-ecto-models</code>. Where <code class="language-plaintext highlighter-rouge">creating-slugs-for-ecto-models</code> is a slug. Pretty cool, isn’t it?</p>

<blockquote>
  <p>So, a slug is a good-looking web-safe unique string used to identify some data.</p>
</blockquote>

<p>Creating slugs is so common, that we have actually created a utility library to generate slugs based on some other fields.
We called it <a href="https://github.com/sobolevn/ecto_autoslug_field">ecto_autoslug_field</a>.</p>


    
      <h2 id="how-does-ectoautoslugfield-work">
        
        <a class="anchor" href="#how-does-ectoautoslugfield-work">How does EctoAutoslugField work?</a>
        
      </h2>

<p>Imagine that you have a simple Article schema inside Blog context.
That’s how it looks like freshly out of the generator:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Ecto</span><span class="o">.</span><span class="no">Schema</span>
  <span class="kn">import</span> <span class="no">Ecto</span><span class="o">.</span><span class="no">Changeset</span>
  <span class="n">alias</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span>

  <span class="n">schema</span> <span class="s2">"blog_articles"</span> <span class="k">do</span>
    <span class="n">field</span> <span class="ss">:breaking</span><span class="p">,</span> <span class="ss">:boolean</span><span class="p">,</span> <span class="ss">default:</span> <span class="no">false</span>
    <span class="n">field</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="n">field</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:string</span>

    <span class="n">timestamps</span><span class="p">()</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="no">false</span>
  <span class="k">def</span> <span class="n">changeset</span><span class="p">(%</span><span class="no">Article</span><span class="p">{}</span> <span class="o">=</span> <span class="n">article</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">article</span>
    <span class="o">|&gt;</span> <span class="n">cast</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="p">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:breaking</span><span class="p">])</span>
    <span class="o">|&gt;</span> <span class="n">validate_required</span><span class="p">([</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:content</span><span class="p">])</span>
    <span class="o">|&gt;</span> <span class="n">unique_constraint</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>It has just three meaning-full fields: <code class="language-plaintext highlighter-rouge">:title</code> which is unique, <code class="language-plaintext highlighter-rouge">:content</code>, and if this article has some <code class="language-plaintext highlighter-rouge">:breaking</code> news in it which is set to false by default.</p>

<p>Now you want to generate a slug from the title.</p>


    
      <h3 id="installation">
        
        <a class="anchor" href="#installation">Installation</a>
        
      </h3>

<p>Firstly, add <code class="language-plaintext highlighter-rouge">{:ecto_autoslug_field, “~&gt; 0.3”}</code> to your <code class="language-plaintext highlighter-rouge">mix.exs</code>.
Then fetch the dependencies with mix deps.get.</p>

<p>Then you will need to add a new field to your schema. Let’s call it <code class="language-plaintext highlighter-rouge">:slug</code>.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Ecto</span><span class="o">.</span><span class="no">Schema</span>
  <span class="kn">import</span> <span class="no">Ecto</span><span class="o">.</span><span class="no">Changeset</span>
  <span class="n">alias</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span>
  <span class="n">alias</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span><span class="o">.</span><span class="no">TitleSlug</span>

  <span class="n">schema</span> <span class="s2">"blog_articles"</span> <span class="k">do</span>
    <span class="n">field</span> <span class="ss">:breaking</span><span class="p">,</span> <span class="ss">:boolean</span><span class="p">,</span> <span class="ss">default:</span> <span class="no">false</span>
    <span class="n">field</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="n">field</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:string</span>

    <span class="n">field</span> <span class="ss">:slug</span><span class="p">,</span> <span class="no">TitleSlug</span><span class="o">.</span><span class="no">Type</span>

    <span class="n">timestamps</span><span class="p">()</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="no">false</span>
  <span class="k">def</span> <span class="n">changeset</span><span class="p">(%</span><span class="no">Article</span><span class="p">{}</span> <span class="o">=</span> <span class="n">article</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">article</span>
    <span class="o">|&gt;</span> <span class="n">cast</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="p">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:breaking</span><span class="p">])</span>
    <span class="o">|&gt;</span> <span class="n">validate_required</span><span class="p">([</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:content</span><span class="p">])</span>
    <span class="o">|&gt;</span> <span class="n">unique_constraint</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="no">TitleSlug</span><span class="o">.</span><span class="n">maybe_generate_slug</span>
    <span class="o">|&gt;</span> <span class="no">TitleSlug</span><span class="o">.</span><span class="n">unique_constraint</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Take a close note on this <code class="language-plaintext highlighter-rouge">TitleSlug</code> used everywhere.
That would be a slug field module. But right now it does not exist.
We will implement it later.</p>

<p>You will also need to add a new migration. It would be something like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Repo</span><span class="o">.</span><span class="no">Migrations</span><span class="o">.</span><span class="no">CreateEctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Ecto</span><span class="o">.</span><span class="no">Migration</span>

  <span class="k">def</span> <span class="n">change</span> <span class="k">do</span>
    <span class="n">alter</span> <span class="n">table</span><span class="p">(</span><span class="ss">:blog_articles</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">add</span> <span class="ss">:slug</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="k">end</span>

    <span class="n">create</span> <span class="n">unique_index</span><span class="p">(</span><span class="ss">:blog_articles</span><span class="p">,</span> <span class="p">[</span><span class="ss">:slug</span><span class="p">])</span> <span class="c1"># should be unique</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>


    
      <h3 id="simple-example">
        
        <a class="anchor" href="#simple-example">Simple example</a>
        
      </h3>

<p>Remember, that we did not implement <code class="language-plaintext highlighter-rouge">TitleSlug</code> yet? Let’s decide what it should look like. The first use case is the simplest one. When an article is created, generate a slug from it’s title. Do nothing more.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span><span class="o">.</span><span class="no">TitleSlug</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">EctoAutoslugField</span><span class="o">.</span><span class="no">Slug</span><span class="p">,</span> <span class="ss">from:</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">to:</span> <span class="ss">:slug</span>
<span class="k">end</span>
</code></pre></div></div>

<p>That’s it. It takes a value from <code class="language-plaintext highlighter-rouge">:from</code> field and puts changes into <code class="language-plaintext highlighter-rouge">:to</code> field. But maybe that’s not what you want? Let’s step it up.</p>


    
      <h3 id="conditional-example">
        
        <a class="anchor" href="#conditional-example">Conditional example</a>
        
      </h3>

<p>Imagine that you have a business rule: put “breaking” in front of every breaking news article’s slug. How could you achieve that?</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span><span class="o">.</span><span class="no">TitleSlug</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">EctoAutoslugField</span><span class="o">.</span><span class="no">Slug</span><span class="p">,</span> <span class="ss">to:</span> <span class="ss">:slug</span>

  <span class="kn">import</span> <span class="no">Ecto</span><span class="o">.</span><span class="no">Changeset</span>

  <span class="k">def</span> <span class="n">get_sources</span><span class="p">(</span><span class="n">changeset</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># This function is used to get sources to build slug from:</span>
    <span class="n">base_fields</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:title</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">get_change</span><span class="p">(</span><span class="n">changeset</span><span class="p">,</span> <span class="ss">:breaking</span><span class="p">,</span> <span class="no">false</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">[</span><span class="s2">"breaking"</span><span class="p">]</span> <span class="o">++</span> <span class="n">base_fields</span>
    <span class="k">else</span>
      <span class="n">base_fields</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Note, that right now we don’t use :from option anymore, instead, we are using a <code class="language-plaintext highlighter-rouge">get_sources/2</code> function.
What does it do? When creating an article it will provide conditional sources for the slug.
And since it has access to the changeset struct the possibilities are endless.
The logic itself is also pretty simple.
When changeset has <code class="language-plaintext highlighter-rouge">:breaking</code> key set to true prepend “breaking” to the sources list.
Your business rule is now satisfied, let’s move on.</p>


    
      <h3 id="modify-the-slug">
        
        <a class="anchor" href="#modify-the-slug">Modify the slug</a>
        
      </h3>

<p>Or maybe you have a different use case?
The business wants your slugs to be joined differently.
So you need to modify the resulting slug. How to do that?</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">EctoSlugs</span><span class="o">.</span><span class="no">Blog</span><span class="o">.</span><span class="no">Article</span><span class="o">.</span><span class="no">TitleSlug</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">EctoAutoslugField</span><span class="o">.</span><span class="no">Slug</span><span class="p">,</span> <span class="ss">from:</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">to:</span> <span class="ss">:slug</span>

  <span class="k">def</span> <span class="n">build_slug</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">_changeset</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">sources</span>
    <span class="o">|&gt;</span> <span class="kn">super</span><span class="p">()</span>
    <span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>It is possible to define a custom <code class="language-plaintext highlighter-rouge">build_slug/2</code> function which accepts two arguments: the list of sources and the initial changeset.
This function is designed to build and return the slug before it is saved to the database.
This <code class="language-plaintext highlighter-rouge">super()</code> call transforms your list of sources into the slug-string.</p>

<p>But before the slug is returned you can do multiple things:</p>

<ul>
  <li>check either your slug is unique, if not — increment it somehow</li>
  <li>modify your slug</li>
  <li>or even build the slug yourself without this magic <code class="language-plaintext highlighter-rouge">super()</code> call</li>
</ul>

<p>And of course, you can use this function alongside the <code class="language-plaintext highlighter-rouge">get_sources/2</code>.</p>


    
      <h2 id="conclusion">
        
        <a class="anchor" href="#conclusion">Conclusion</a>
        
      </h2>

<p>That’s a short introduction to <code class="language-plaintext highlighter-rouge">ecto_autoslug_field</code>.</p>

<p>But that’s not even all its features covered! There are more options and possibilities.
Like, recreating slug on every save with <code class="language-plaintext highlighter-rouge">:always_change</code> option and others.
We have tried to cover everything inside documentation and it is <a href="https://hexdocs.pm/ecto_autoslug_field/readme.html">available online</a>.</p>

<p>Check <code class="language-plaintext highlighter-rouge">ecto_autoslug_field</code> out:
<a href="https://github.com/sobolevn/ecto_autoslug_field">ecto_autoslug_field - Automatically create slugs for Ecto schemas.</a></p>

    </div>

    <hr>

    <div class="post-subscribe">
      <h2>
        <a href="https://sobolevn.me/subscribe">
          Subscribe to my blog if you want more
        </a>
      </h2>
    </div>

    
    
    <div class="post-republish">
      <h4>Republished as:</h4>
      <ul>
      
        <li>
          <a class="c-article__repost" href="https://medium.com/wemake-services/creating-slugs-for-ecto-schemas-7349513410f0" target="_blank">
            
            medium.com <img class="emoji" title=":us:" alt=":us:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1f8.png" height="20" width="20">
          </a>
        </li>
      
      </ul>
    </div>
    
  </div>

  <!-- Disqus comments view -->
  
</article>

  </div>
  <footer class="c-page__footer">
  <p>
    <i class="far fa-copyright"></i>
    <a href="https://sobolevn.me/about/">imrishi</a>
    2023,
    content licensed
    <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">
      CC BY-NC
    </a>,
    <a href="https://github.com/sobolevn/sobolevn.github.io" target="_blank">
      source code
    </a>
  </p>

  <p>
    <a href="mailto:r@rishi.im" alt="email">
      <i class="far fa-2x fa-envelope"></i>
    </a>
    <a href="https://github.com/sobolevn" alt="github">
      <i class="fab fa-2x fa-github"></i>
    </a>
    <a href="https://dev.to/sobolevn" alt="practicaldev">
      <i class="fab fa-2x fa-dev"></i>
    </a>
    <a href="https://medium.com/@sobolevn" alt="medium">
      <i class="fab fa-2x fa-medium"></i>
    </a>
    <a href="https://stackoverflow.com/users/4842742/sobolevn" alt="stackoverflow">
      <i class="fab fa-2x fa-stack-overflow"></i>
    </a>
  </p>
</footer>

</div>

    </main>

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66588818-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-66588818-1');
</script>

  </body>
</html>
