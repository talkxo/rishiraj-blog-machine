<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/images/favicons/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/images/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Meta information -->
  <title>Simple dependent types in Python</title>
  <meta name="description"
        content="">
  <link rel="canonical"
        href="http://localhost:4000/2019/01/simple-dependent-types-in-python" />

  <!-- Open search scheme -->
  <link rel="search"
        type="application/opensearchdescription+xml"
        title="sobolevn.me"
        href="/opensearch.xml" />

  <!-- Feed -->
  <link rel="alternate" type="application/rss+xml" title="rishi raj's blog"
        href="/feed.xml" />

  <!-- Custom fonts -->
  <link href="https://fonts.googleapis.com/css?family=Merriweather:400,400i,900|Roboto+Mono:400,400i|Montserrat:400,800" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

  <!-- Custom style -->
  <link rel="stylesheet" href="/css/main.css" />

  <!-- Global site tag (gtag.js) - Google Ads: 839642990 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-839642990"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-839642990');
  </script>
</head>


  <body>
    <main class="u-container">
      <div class="c-page">
  <header class="c-page__header">
  <h1><code>rishi raj's blog</code></h1>

  

  <nav role="navigation">
    <a href="/" role="menuitem">
      Blog
    </a>

    <span class="u-separate"></span>
    <a href="/talks/" role="menuitem">
      Talks
    </a>

    <span class="u-separate"></span>
    <a href="/activities/" role="menuitem">
      Activities
    </a>

    <span class="u-separate"></span>
    <a href="/about/" role="menuitem">
      About
    </a>

    <span class="u-separate"></span>
    <a href="/subscribe/" role="menuitem">
      Subscribe
    </a>
  </nav>
</header>

  <div class="c-page__main">
    <article class="c-article" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header class="c-article__header">
    <h1 class="c-article__title" itemprop="name">Simple dependent types in Python</h1>
    <p class="c-article__time">
      <small>
        <time datetime="2019-01-31T00:00:00+05:30" itemprop="datePublished">
          January 31, 2019
        </time>
      </small>
      <small><span class="reading-time" title="Estimated read time">
  
  
    12 mins
   read
</span>
</small>
      <small><a href="#discussion">Start a discussion</a></small>
      <small><a href="https://github.com/sobolevn/sobolevn.github.io/blob/master/_posts/2019-01-31-simple-dependent-types-in-python.md">Edit this page</a></small>
    </p>
  </header>

  <!-- Post Tags -->
  <!-- <ul class="c-tags">
    
    <li class="c-tag">python</li>
    
  </ul> -->

  <!-- Content -->
  <div class="c-article__main">

    

    <div class="c-article__body" itemprop="articleBody">
      <p><img src="https://thepracticaldev.s3.amazonaws.com/i/d1e3x1c4eom0vy9u8gd9.png" alt="Post logo and title"></p>

<p>I am quite excited about this new feature in <code class="language-plaintext highlighter-rouge">python</code>: simple dependent types.
“Dependent types” might sound complex, but it is not. Instead, it is a useful feature and I am going to show how it works and when you should rely on it.</p>

<p>We are not going to dive deep into the theory and I am not going to provide any kind of math formulas here. As Steven Hawking once said:</p>

<blockquote>
  <p>Someone told me that each equation I included in the book would halve the sales. I, therefore, resolved not to have any equations at all. In the end, however, I did put in one equation, Einstein’s famous equation, E=mc^2. I hope that this will not scare off half of my potential readers</p>
</blockquote>

<p>What is dependent typing? It is a concept when you rely on values of some types, not just raw types.</p>

<p>Consider this example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="k">def</span> <span class="nf">return_int_or_str</span><span class="p">(</span><span class="n">flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">'I am a string!'</span>
    <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></div>

<p>We can clearly see that depending on the value of <code class="language-plaintext highlighter-rouge">flag</code> we can get <code class="language-plaintext highlighter-rouge">str</code> or <code class="language-plaintext highlighter-rouge">int</code> values. The result type will be <code class="language-plaintext highlighter-rouge">Union[str, int]</code>. And every time we call this function with mixed-up-return-type we have to check what type we actually got and what to do with it. This is inconvenient and makes your code more complex.</p>

<p>You might say that this function is just bad, and it should not behave the way it does now. Correct, but there are some real-world use-cases where this is required by design.</p>

<p>Consider <a href="https://docs.python.org/3/library/functions.html#open"><code class="language-plaintext highlighter-rouge">open</code> function from the standard library</a>. How often did you get runtime errors because you mixed up <code class="language-plaintext highlighter-rouge">str</code> and <code class="language-plaintext highlighter-rouge">bytes</code>? It happened a thousand times to me. And I do not want this to happen again! So, we will write type-safe code for this time.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</code></pre></div></div>

<p>What return type do we expect here? <code class="language-plaintext highlighter-rouge">str</code>? Wait for a second! We can call it like so: <code class="language-plaintext highlighter-rouge">open_file('some.txt', 'rb')</code> and it will return <code class="language-plaintext highlighter-rouge">bytes</code>! So, the return type is <a href="https://mypy.readthedocs.io/en/latest/cheat_sheet_py3.html#miscellaneous"><code class="language-plaintext highlighter-rouge">Union[IO[str], IO[bytes]]</code></a>. And it really hard to work with it. We will end up with a lot of conditions, unneeded casts, and guards.</p>

<p>Dependent types solve this problem. But, before we will move any further - we have to know some primitives that we are going to use later.</p>


      <h2 id="literal-and-overload">
        
        <a class="anchor" href="#literal-and-overload">Literal and @overload</a>
        
      </h2>

<p>If you don’t have <code class="language-plaintext highlighter-rouge">mypy</code> and <code class="language-plaintext highlighter-rouge">typing_extensions</code> installed, you need to install the latest version of these packages.</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">» pip install mypy typing_extensions
</span></code></pre></div></div>

<p>And now we are ready to rewrite our code with the power of <code class="language-plaintext highlighter-rouge">Literal</code> and <code class="language-plaintext highlighter-rouge">@overload</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span>
<span class="kn">from</span> <span class="nn">typing_extension</span> <span class="kn">import</span> <span class="n">Literal</span>
</code></pre></div></div>

<p>A quick side <strong>note</strong>: <code class="language-plaintext highlighter-rouge">typing</code> is a builtin <code class="language-plaintext highlighter-rouge">python</code> module where all possible types are defined. And the development speed of this module is limited to the new <code class="language-plaintext highlighter-rouge">python</code> version releases. And <code class="language-plaintext highlighter-rouge">typing_extensions</code> is an official package for new types that will be available in the future releases of <code class="language-plaintext highlighter-rouge">python</code>. So, it does solve all issues with the release speed and frequency of regular <code class="language-plaintext highlighter-rouge">typing</code> module.</p>


    
      <h3 id="literal">
        
        <a class="anchor" href="#literal">Literal</a>
        
      </h3>

<p><code class="language-plaintext highlighter-rouge">Literal</code> type represents a specific value of the specific type.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
     <span class="k">return</span> <span class="n">x</span>

<span class="n">function</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; OK!
</span>
<span class="n">function</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; Argument has incompatible type "Literal[2]"; expected "Literal[1]"
</span></code></pre></div></div>

<p>To run this code use: <code class="language-plaintext highlighter-rouge">mypy --python-version=3.6 --strict test.py</code>. It will remain the same for all examples in this article.</p>

<p>That’s awesome! But, what is the difference between <code class="language-plaintext highlighter-rouge">Literal[0]</code> and <code class="language-plaintext highlighter-rouge">int</code> type?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1"># =&gt; Revealed type is 'builtins.int'
</span>    <span class="n">reveal_type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="c1"># =&gt; Revealed type is 'Literal[0]'
</span>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></div>

<p>Revealed types differ. The only way to get <code class="language-plaintext highlighter-rouge">Literal</code> type is to annotate is as <code class="language-plaintext highlighter-rouge">Literal</code>. It is done to save backward compatibility with older versions of <code class="language-plaintext highlighter-rouge">mypy</code> and not to detect <code class="language-plaintext highlighter-rouge">x: int = 0</code> as a <code class="language-plaintext highlighter-rouge">Literal</code> type. Because the value of <code class="language-plaintext highlighter-rouge">x</code> can later be changed.</p>

<p>You can use <code class="language-plaintext highlighter-rouge">Literal[0]</code> everywhere where a regular <code class="language-plaintext highlighter-rouge">int</code> can be used, but not the other way around.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">x1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y1</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">function</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
<span class="n">function</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
<span class="c1"># =&gt; Argument 2 has incompatible type "int"; expected "Literal[0]"
</span></code></pre></div></div>

<p>See? Since <code class="language-plaintext highlighter-rouge">x1</code> is a variable - it cannot be used where we expect <code class="language-plaintext highlighter-rouge">Literal</code>s.
In the first part of this series, I wrote an article about <a href="https://sobolevn.me/2018/07/real-python-contants">using real constants in <code class="language-plaintext highlighter-rouge">python</code></a>. Read it if you do not know the difference between variables and constants in <code class="language-plaintext highlighter-rouge">python</code>.</p>

<p>Will constants help in this case? Yes, they will!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Final</span>

<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
     <span class="k">return</span> <span class="n">x</span>

<span class="n">x</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">function</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<p>As you can see, when declaring some value <code class="language-plaintext highlighter-rouge">Final</code> - we create a constant. That cannot be changed. And it matches what <code class="language-plaintext highlighter-rouge">Literal</code> is. Source code implementation of these two types is also quite similar.</p>

<p>Why do I constantly call dependent types in <code class="language-plaintext highlighter-rouge">python</code> simple? Because it is currently limited to simple values: <code class="language-plaintext highlighter-rouge">int</code>, <code class="language-plaintext highlighter-rouge">str</code>, <code class="language-plaintext highlighter-rouge">bool</code>, <code class="language-plaintext highlighter-rouge">float</code>, <code class="language-plaintext highlighter-rouge">None</code>. It can not currently work with tuples, lists, dicts, custom types and classes, etc. But, you can track the development progress <a href="https://github.com/python/mypy/issues/3062">in this thread</a>.</p>

<p>Do not forget about <a href="https://mypy.readthedocs.io/en/latest/literal_types.html">the official docs</a>.</p>


    
      <h3 id="overload">
        
        <a class="anchor" href="#overload">@overload</a>
        
      </h3>

<p>The next thing we will need is <code class="language-plaintext highlighter-rouge">@overload</code> decorator. It is required to define multiple function declarations with different input types and results.</p>

<p>Imagine, we have a situation when we need to write a function that decreases a value. It should work with both <code class="language-plaintext highlighter-rouge">str</code> and <code class="language-plaintext highlighter-rouge">int</code> inputs. When given <code class="language-plaintext highlighter-rouge">str</code> it should return all the input characters except the last one, but when given <code class="language-plaintext highlighter-rouge">int</code> it should return the previous number.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="k">def</span> <span class="nf">decrease</span><span class="p">(</span><span class="n">first</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">first</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">first</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">decrease</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># =&gt; Revealed type is 'Union[builtins.str, builtins.int]'
</span><span class="n">reveal_type</span><span class="p">(</span><span class="n">decrease</span><span class="p">(</span><span class="s">'abc'</span><span class="p">))</span>
<span class="c1"># =&gt; Revealed type is 'Union[builtins.str, builtins.int]'
</span></code></pre></div></div>

<p>Not too practical, isn’t it? <code class="language-plaintext highlighter-rouge">mypy</code> still does not know what specific type was returned. We can enhance the typing with <code class="language-plaintext highlighter-rouge">@overload</code> decorator.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">overload</span>

<span class="o">@</span><span class="n">overload</span>
<span class="k">def</span> <span class="nf">decrease</span><span class="p">(</span><span class="n">first</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s">"""Decreases a string."""</span>

<span class="o">@</span><span class="n">overload</span>
<span class="k">def</span> <span class="nf">decrease</span><span class="p">(</span><span class="n">first</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="s">"""Decreases a number."""</span>

<span class="k">def</span> <span class="nf">decrease</span><span class="p">(</span><span class="n">first</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">first</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">first</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">decrease</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># =&gt; Revealed type is 'builtins.int'
</span><span class="n">reveal_type</span><span class="p">(</span><span class="n">decrease</span><span class="p">(</span><span class="s">'abc'</span><span class="p">))</span>
<span class="c1"># =&gt; Revealed type is 'builtins.str'
</span></code></pre></div></div>

<p>In this case, we define several function heads to give <code class="language-plaintext highlighter-rouge">mypy</code> enough information about what is going on. And these head functions are only used during the type checking this module. As you can see only one function definition actually contains some logic. You can create as many function heads as you need.</p>

<p>The idea is: whenever <code class="language-plaintext highlighter-rouge">mypy</code> finds a function with multiple <code class="language-plaintext highlighter-rouge">@overload</code> heads it tries to match input values to these declarations. When it finds the first match - it returns the result type.</p>

<p><a href="https://mypy.readthedocs.io/en/latest/more_types.html#function-overloading">Official documentation</a> might also help you to understand how to use it in your projects.</p>


    
      <h2 id="dependent-types">
        
        <a class="anchor" href="#dependent-types">Dependent types</a>
        
      </h2>

<p>Now, we are going to combine our new knowledge about <code class="language-plaintext highlighter-rouge">Literal</code> and <code class="language-plaintext highlighter-rouge">@overload</code> together to solve our problem with <code class="language-plaintext highlighter-rouge">open</code>. At last!</p>

<p>Remember, we need to return <code class="language-plaintext highlighter-rouge">bytes</code> for <code class="language-plaintext highlighter-rouge">'rb'</code> mode and <code class="language-plaintext highlighter-rouge">str</code> for <code class="language-plaintext highlighter-rouge">'r'</code> mode.
And we need to know the exact return type.</p>

<p>An algorithm will be:</p>

<ol>
  <li>Write several <code class="language-plaintext highlighter-rouge">@overload</code> decorators to match all possible cases</li>
  <li>Write <code class="language-plaintext highlighter-rouge">Literal[]</code> types when we expect to get <code class="language-plaintext highlighter-rouge">'r'</code> or <code class="language-plaintext highlighter-rouge">'rb'</code>
</li>
  <li>Write function logic in a general case</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">IO</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">overload</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="o">@</span><span class="n">overload</span>
<span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s">'r'</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="s">"""When 'r' is supplied we return 'str'."""</span>

<span class="o">@</span><span class="n">overload</span>
<span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s">'rb'</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
    <span class="s">"""When 'rb' is supplied we return 'bytes' instead of a 'str'."""</span>

<span class="o">@</span><span class="n">overload</span>
<span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
    <span class="s">"""Any other options might return Any-thing!."""</span>

<span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">open_file</span><span class="p">(</span><span class="s">'some.txt'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">))</span>
<span class="c1"># =&gt; Revealed type is 'typing.IO[builtins.str]'
</span><span class="n">reveal_type</span><span class="p">(</span><span class="n">open_file</span><span class="p">(</span><span class="s">'some.txt'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">))</span>
<span class="c1"># =&gt; Revealed type is 'typing.IO[builtins.bytes]'
</span><span class="n">reveal_type</span><span class="p">(</span><span class="n">open_file</span><span class="p">(</span><span class="s">'some.txt'</span><span class="p">,</span> <span class="s">'other'</span><span class="p">))</span>
<span class="c1"># =&gt; Revealed type is 'typing.IO[AnyStr]'
</span>
</code></pre></div></div>

<p>What do we have here? Three <code class="language-plaintext highlighter-rouge">@overload</code> decorators and a function body with logic. First <code class="language-plaintext highlighter-rouge">@overload</code> decorator declares to return <code class="language-plaintext highlighter-rouge">str</code> for <code class="language-plaintext highlighter-rouge">'r'</code> <code class="language-plaintext highlighter-rouge">Literal</code> parameter, the second one tells to return <code class="language-plaintext highlighter-rouge">bytes</code> when we use <code class="language-plaintext highlighter-rouge">'rb'</code> parameter. And the third one is fallback. Whenever we provide another any other mode - we can get both <code class="language-plaintext highlighter-rouge">str</code> and <code class="language-plaintext highlighter-rouge">bytes</code>.</p>

<p>Now, our problem is solved. We supply some specific values into the function, we receive some specific type in return. It makes our code easier to read and safer to execute.</p>

<p>Thanks how dependent types work in <code class="language-plaintext highlighter-rouge">python</code>!</p>


    
      <h2 id="conclusion">
        
        <a class="anchor" href="#conclusion">Conclusion</a>
        
      </h2>

<p>I hope this little tutorial helped you to understand typing in <code class="language-plaintext highlighter-rouge">python</code> a little bit better. In the future articles, I will cover more complex topics about <code class="language-plaintext highlighter-rouge">mypy</code>.
<a href="https://github.com/sobolevn">Follow me on Github</a> to subscribe to both my blog and a feed of my new open-source projects.</p>

    </div>

    <hr>

    <div class="post-subscribe">
      <h2>
        <a href="https://sobolevn.me/subscribe">
          Subscribe to my blog if you want more
        </a>
      </h2>
    </div>

    
    
    <div class="post-republish">
      <h4>Republished as:</h4>
      <ul>
      
        <li>
          <a class="c-article__repost" href="https://dev.to/wemake-services/simple-dependent-types-in-python-4e14" target="_blank">
            
            dev.to <img class="emoji" title=":us:" alt=":us:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1f8.png" height="20" width="20">
          </a>
        </li>
      
      </ul>
    </div>
    
  </div>

  <!-- Disqus comments view -->
  
</article>

  </div>
  <footer class="c-page__footer">
  <p>
    <i class="far fa-copyright"></i>
    <a href="https://sobolevn.me/about/">imrishi</a>
    2023,
    content licensed
    <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">
      CC BY-NC
    </a>,
    <a href="https://github.com/sobolevn/sobolevn.github.io" target="_blank">
      source code
    </a>
  </p>

  <p>
    <a href="mailto:r@rishi.im" alt="email">
      <i class="far fa-2x fa-envelope"></i>
    </a>
    <a href="https://github.com/sobolevn" alt="github">
      <i class="fab fa-2x fa-github"></i>
    </a>
    <a href="https://dev.to/sobolevn" alt="practicaldev">
      <i class="fab fa-2x fa-dev"></i>
    </a>
    <a href="https://medium.com/@sobolevn" alt="medium">
      <i class="fab fa-2x fa-medium"></i>
    </a>
    <a href="https://stackoverflow.com/users/4842742/sobolevn" alt="stackoverflow">
      <i class="fab fa-2x fa-stack-overflow"></i>
    </a>
  </p>
</footer>

</div>

    </main>

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66588818-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-66588818-1');
</script>

  </body>
</html>
